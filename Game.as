// Darwin Games 2012package {	import flash.geom.*;	import flash.display.*;	import flash.events.*;	public class Game extends Sprite {		var CONCURRENT_SIMS = 3;		var simulationBitmapDatas;		var simulations;		var spritesheetBitmapData;		var backbufferBitmapData;		var frontbufferBitmapData;		var frontbufferBitmap;		var stageRect;		var origo = new Point(0,0);		var betting = new Betting();		function r(obj) {			return new Rectangle(0, 0, obj.width, obj.height);		}		var phase = 'BETTING';		function refresh(evt) {			if (phase == 'SPORT') {				for (var i = 0; i < CONCURRENT_SIMS; i++) {					var sim = simulations[i];					var simulationBitmapData = simulationBitmapDatas[i];					sim.tick();					sim.render();					frontbufferBitmapData.copyPixels(simulationBitmapData, r(simulationBitmapData), new Point(150, 100 + i * 150), null, new Point(0,0), true);				}			}//			frontbufferBitmapData.copyPixels(backbufferBitmapData, r(backbufferBitmapData), origo);		}		var creatures = [];		function makeCreatures() {			for (var i = 0; i < CONCURRENT_SIMS; i++) {				var creatureBitmapData = new BitmapData(32, 32);				creatureBitmapData.copyPixels(spritesheetBitmapData, new Rectangle(i*32,32,32,32), new Point(0,0));				var creature = new Creature(creatureBitmapData);				creatures.push(creature);			}		}		function startSport() {			phase = 'SPORT';			simulationBitmapDatas = [];			simulations = [];			for (var i = 0; i < CONCURRENT_SIMS; i++) {				var simulationBitmapData = new BitmapData(500, 100);				var sim = new Simulation(simulationBitmapData, spritesheetBitmapData, creatures[i]);				simulationBitmapDatas.push(simulationBitmapData);				simulations.push(sim);			}		}		public function startBetting() {			phase = 'BETTING';		}		public function placeBet1(evt) {			betting.amount1.text = int(betting.amount1.text) + 1;			betting.coins.text = int(betting.coins.text) - 1;		}		public function placeBet2(evt) {			betting.amount2.text = int(betting.amount2.text) + 1;			betting.coins.text = int(betting.coins.text) - 1;		}		public function placeBet3(evt) {			betting.amount3.text = int(betting.amount3.text) + 1;			betting.coins.text = int(betting.coins.text) - 1;		}		public function initBettingScreen() {			betting.start.addEventListener(MouseEvent.CLICK, matchStartClicked);			betting.bet1.addEventListener(MouseEvent.CLICK, placeBet1);			betting.bet2.addEventListener(MouseEvent.CLICK, placeBet2);			betting.bet3.addEventListener(MouseEvent.CLICK, placeBet3);		}		var compoScreen;		public function matchStartClicked(evt) {			// Could transition here			removeChild(betting);			addChild(compoScreen);			startSport();		}		function initCompoScreen(mainTimeline) {			compoScreen = new CompoScreen();			backbufferBitmapData = new BitmapData(mainTimeline.stage.stageWidth, mainTimeline.stage.stageHeight);			backbufferBitmapData.fillRect(r(backbufferBitmapData), 0x0);			frontbufferBitmapData = backbufferBitmapData.clone();			frontbufferBitmap = new Bitmap(frontbufferBitmapData);			compoScreen.addChild(frontbufferBitmap);		}		public function Game(mainTimeline) {			mainTimeline.addEventListener(Event.ENTER_FRAME, refresh);			spritesheetBitmapData = new Sheet(0,0);			makeCreatures();			initCompoScreen(mainTimeline);			initBettingScreen();			addChild(betting);			startBetting();//			startSport();		}	}}